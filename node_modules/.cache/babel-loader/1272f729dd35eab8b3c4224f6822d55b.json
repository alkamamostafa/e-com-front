{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\ALKAMA\\\\Desktop\\\\commerce\\\\ecommerce-spring-reactjs\\\\frontend\\\\src\\\\pages\\\\Product\\\\Product.tsx\";\nimport React, { useEffect, useState } from \"react\";\nimport { Route, useHistory, useParams } from \"react-router-dom\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport SockJS from \"sockjs-client\";\nimport { Stomp } from \"@stomp/stompjs\";\nimport { WEBSOCKET_URL } from \"../../constants/urlConstants\";\nimport { fetchPerfume, fetchReviewsByPerfumeId } from \"../../redux/perfume/perfume-thunks\";\nimport { addReviewToPerfume } from \"../../redux/user/user-thunks\";\nimport Spinner from \"../../component/Spinner/Spinner\";\nimport ProductReview from \"./ProductReview/ProductReview\";\nimport ScrollButton from \"../../component/ScrollButton/ScrollButton\";\nimport { selectIsPerfumeLoaded, selectIsPerfumeLoading, selectPerfume, selectPerfumeError, selectPerfumeErrorMessage, selectReviews } from \"../../redux/perfume/perfume-selector\";\nimport { selectIsReviewAdded, selectReviewErrors } from \"../../redux/user/user-selector\";\nimport { resetPerfumeState, setReview } from \"../../redux/perfume/perfume-actions\";\nimport { resetInputForm } from \"../../redux/user/user-actions\";\nimport { CART } from \"../../constants/routeConstants\";\nimport ProductInfo from \"./ProductInfo/ProductInfo\";\nimport ProductReviewForm from \"./ProductReviewForm/ProductReviewForm\";\nimport \"./Product.css\";\nlet stompClient = null;\n\nconst Product = () => {\n  const dispatch = useDispatch();\n  const history = useHistory();\n  const params = useParams();\n  const perfume = useSelector(selectPerfume);\n  const reviews = useSelector(selectReviews);\n  const isPerfumeLoading = useSelector(selectIsPerfumeLoading);\n  const isPerfumeLoaded = useSelector(selectIsPerfumeLoaded);\n  const isPerfumeError = useSelector(selectPerfumeError);\n  const errorMessage = useSelector(selectPerfumeErrorMessage);\n  const errors = useSelector(selectReviewErrors);\n  const isReviewAdded = useSelector(selectIsReviewAdded);\n  const [author, setAuthor] = useState(\"\");\n  const [message, setMessage] = useState(\"\");\n  const [rating, setRating] = useState(0);\n  useEffect(() => {\n    // GraphQL example\n    // dispatch(fetchPerfumeByQuery(params.id));\n    dispatch(fetchPerfume(params.id));\n    dispatch(resetInputForm());\n    window.scrollTo(0, 0);\n    const socket = new SockJS(WEBSOCKET_URL);\n    stompClient = Stomp.over(socket);\n    stompClient.connect({}, () => {\n      var _stompClient;\n\n      (_stompClient = stompClient) === null || _stompClient === void 0 ? void 0 : _stompClient.subscribe(\"/topic/reviews/\" + params.id, response => {\n        dispatch(setReview(JSON.parse(response.body)));\n      });\n    });\n    return () => {\n      var _stompClient2;\n\n      (_stompClient2 = stompClient) === null || _stompClient2 === void 0 ? void 0 : _stompClient2.disconnect();\n      dispatch(resetPerfumeState());\n    };\n  }, []);\n  useEffect(() => {\n    if (isPerfumeLoaded) {\n      dispatch(fetchReviewsByPerfumeId(params.id));\n    }\n  }, [isPerfumeLoaded]);\n  useEffect(() => {\n    setAuthor(\"\");\n    setMessage(\"\");\n    setRating(0);\n  }, [isReviewAdded]);\n\n  const addToCart = () => {\n    const perfumeId = perfume.id;\n    let data = localStorage.getItem(\"perfumes\");\n    let cart = data ? new Map(JSON.parse(data)) : new Map();\n\n    if (cart.has(perfumeId)) {\n      cart.set(perfumeId, cart.get(perfumeId) + 1);\n    } else {\n      cart.set(perfumeId, 1);\n    }\n\n    localStorage.setItem(\"perfumes\", JSON.stringify(Array.from(cart.entries())));\n    history.push(CART);\n  };\n\n  const addReview = event => {\n    event.preventDefault();\n    const review = {\n      perfumeId: params.id,\n      author,\n      message,\n      rating\n    };\n    dispatch(addReviewToPerfume(review));\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"container mt-5 pb-5\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 9\n    }\n  }, isPerfumeLoading ? /*#__PURE__*/React.createElement(Spinner, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 17\n    }\n  }) : /*#__PURE__*/React.createElement(React.Fragment, null, isPerfumeError ? /*#__PURE__*/React.createElement(\"h2\", {\n    className: \"text-center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 25\n    }\n  }, errorMessage) : /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(ScrollButton, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 29\n    }\n  }), /*#__PURE__*/React.createElement(ProductInfo, {\n    perfume: perfume,\n    reviewLength: reviews.length,\n    addToCart: addToCart,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 29\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"mt-5\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(\"h3\", {\n    className: \"text-center mb-5\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 33\n    }\n  }, \"REVIEWS\"), /*#__PURE__*/React.createElement(Route, {\n    exact: true,\n    component: () => /*#__PURE__*/React.createElement(ProductReview, {\n      data: reviews,\n      itemsPerPage: 5,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 63\n      }\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 33\n    }\n  }), /*#__PURE__*/React.createElement(ProductReviewForm, {\n    addReview: addReview,\n    errors: errors,\n    author: author,\n    setAuthor: setAuthor,\n    rating: rating,\n    setRating: setRating,\n    message: message,\n    setMessage: setMessage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 33\n    }\n  })))));\n};\n\nexport default Product;","map":{"version":3,"names":["React","useEffect","useState","Route","useHistory","useParams","useDispatch","useSelector","SockJS","Stomp","WEBSOCKET_URL","fetchPerfume","fetchReviewsByPerfumeId","addReviewToPerfume","Spinner","ProductReview","ScrollButton","selectIsPerfumeLoaded","selectIsPerfumeLoading","selectPerfume","selectPerfumeError","selectPerfumeErrorMessage","selectReviews","selectIsReviewAdded","selectReviewErrors","resetPerfumeState","setReview","resetInputForm","CART","ProductInfo","ProductReviewForm","stompClient","Product","dispatch","history","params","perfume","reviews","isPerfumeLoading","isPerfumeLoaded","isPerfumeError","errorMessage","errors","isReviewAdded","author","setAuthor","message","setMessage","rating","setRating","id","window","scrollTo","socket","over","connect","subscribe","response","JSON","parse","body","disconnect","addToCart","perfumeId","data","localStorage","getItem","cart","Map","has","set","get","setItem","stringify","Array","from","entries","push","addReview","event","preventDefault","review","length"],"sources":["C:/Users/ALKAMA/Desktop/commerce/ecommerce-spring-reactjs/frontend/src/pages/Product/Product.tsx"],"sourcesContent":["import React, { FC, FormEvent, ReactElement, useEffect, useState } from \"react\";\r\nimport { Route, useHistory, useParams } from \"react-router-dom\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport SockJS from \"sockjs-client\";\r\nimport { CompatClient, Stomp } from \"@stomp/stompjs\";\r\n\r\nimport { WEBSOCKET_URL } from \"../../constants/urlConstants\";\r\nimport { fetchPerfume, fetchReviewsByPerfumeId } from \"../../redux/perfume/perfume-thunks\";\r\nimport { addReviewToPerfume } from \"../../redux/user/user-thunks\";\r\nimport { ReviewRequest } from \"../../types/types\";\r\nimport Spinner from \"../../component/Spinner/Spinner\";\r\nimport ProductReview from \"./ProductReview/ProductReview\";\r\nimport ScrollButton from \"../../component/ScrollButton/ScrollButton\";\r\nimport {\r\n    selectIsPerfumeLoaded,\r\n    selectIsPerfumeLoading,\r\n    selectPerfume,\r\n    selectPerfumeError,\r\n    selectPerfumeErrorMessage,\r\n    selectReviews\r\n} from \"../../redux/perfume/perfume-selector\";\r\nimport { selectIsReviewAdded, selectReviewErrors } from \"../../redux/user/user-selector\";\r\nimport { resetPerfumeState, setReview } from \"../../redux/perfume/perfume-actions\";\r\nimport { resetInputForm } from \"../../redux/user/user-actions\";\r\nimport { CART } from \"../../constants/routeConstants\";\r\nimport ProductInfo from \"./ProductInfo/ProductInfo\";\r\nimport ProductReviewForm from \"./ProductReviewForm/ProductReviewForm\";\r\nimport \"./Product.css\";\r\n\r\nlet stompClient: CompatClient | null = null;\r\n\r\nconst Product: FC = (): ReactElement => {\r\n    const dispatch = useDispatch();\r\n    const history = useHistory();\r\n    const params = useParams<{ id: string }>();\r\n    const perfume = useSelector(selectPerfume);\r\n    const reviews = useSelector(selectReviews);\r\n    const isPerfumeLoading = useSelector(selectIsPerfumeLoading);\r\n    const isPerfumeLoaded = useSelector(selectIsPerfumeLoaded);\r\n    const isPerfumeError = useSelector(selectPerfumeError);\r\n    const errorMessage = useSelector(selectPerfumeErrorMessage);\r\n    const errors = useSelector(selectReviewErrors);\r\n    const isReviewAdded = useSelector(selectIsReviewAdded);\r\n\r\n    const [author, setAuthor] = useState<string>(\"\");\r\n    const [message, setMessage] = useState<string>(\"\");\r\n    const [rating, setRating] = useState<number>(0);\r\n\r\n    useEffect(() => {\r\n        // GraphQL example\r\n        // dispatch(fetchPerfumeByQuery(params.id));\r\n        dispatch(fetchPerfume(params.id));\r\n        dispatch(resetInputForm());\r\n        window.scrollTo(0, 0);\r\n        const socket = new SockJS(WEBSOCKET_URL);\r\n        stompClient = Stomp.over(socket);\r\n        stompClient.connect({}, () => {\r\n            stompClient?.subscribe(\"/topic/reviews/\" + params.id, (response: any) => {\r\n                dispatch(setReview(JSON.parse(response.body)));\r\n            });\r\n        });\r\n\r\n        return () => {\r\n            stompClient?.disconnect();\r\n            dispatch(resetPerfumeState());\r\n        };\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (isPerfumeLoaded) {\r\n            dispatch(fetchReviewsByPerfumeId(params.id));\r\n        }\r\n    }, [isPerfumeLoaded]);\r\n\r\n    useEffect(() => {\r\n        setAuthor(\"\");\r\n        setMessage(\"\");\r\n        setRating(0);\r\n    }, [isReviewAdded]);\r\n\r\n    const addToCart = (): void => {\r\n        const perfumeId: number | undefined = perfume.id;\r\n        let data: string | null = localStorage.getItem(\"perfumes\");\r\n        let cart: Map<number, any> = data ? new Map(JSON.parse(data as string)) : new Map();\r\n\r\n        if (cart.has(perfumeId as number)) {\r\n            cart.set(perfumeId as number, cart.get(perfumeId as number) + 1);\r\n        } else {\r\n            cart.set(perfumeId as number, 1);\r\n        }\r\n        localStorage.setItem(\"perfumes\", JSON.stringify(Array.from(cart.entries())));\r\n        history.push(CART);\r\n    };\r\n\r\n    const addReview = (event: FormEvent<HTMLFormElement>): void => {\r\n        event.preventDefault();\r\n        const review: ReviewRequest = { perfumeId: params.id as string, author, message, rating };\r\n        dispatch(addReviewToPerfume(review));\r\n    };\r\n\r\n    return (\r\n        <div className=\"container mt-5 pb-5\">\r\n            {isPerfumeLoading ? (\r\n                <Spinner />\r\n            ) : (\r\n                <>\r\n                    {isPerfumeError ? (\r\n                        <h2 className=\"text-center\">{errorMessage}</h2>\r\n                    ) : (\r\n                        <>\r\n                            <ScrollButton />\r\n                            <ProductInfo perfume={perfume} reviewLength={reviews.length} addToCart={addToCart} />\r\n                            <div className=\"mt-5\">\r\n                                <h3 className=\"text-center mb-5\">REVIEWS</h3>\r\n                                <Route exact component={() => <ProductReview data={reviews} itemsPerPage={5} />} />\r\n                                <ProductReviewForm\r\n                                    addReview={addReview}\r\n                                    errors={errors}\r\n                                    author={author}\r\n                                    setAuthor={setAuthor}\r\n                                    rating={rating}\r\n                                    setRating={setRating}\r\n                                    message={message}\r\n                                    setMessage={setMessage}\r\n                                />\r\n                            </div>\r\n                        </>\r\n                    )}\r\n                </>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Product;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}